<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultado da Triagem - Sistema Hospitalar Inteligente</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <meta name="description" content="Resultado da classifica√ß√£o de risco da triagem hospitalar">
</head>
<body>
    <header role="banner">
        <nav aria-label="Navega√ß√£o principal">
            <div class="nav-container">
                <div class="logo">
                    <h1>üè• Triagem Hospitalar IA</h1>
                </div>
                <ul class="nav-menu" role="menubar">
                    <li role="none"><a href="{{ url_for('index') }}" role="menuitem">In√≠cio</a></li>
                    <li role="none"><a href="{{ url_for('triagem') }}" role="menuitem">Triagem</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main id="main-content" role="main">
        <div class="container">
            <section class="resultado-header" aria-labelledby="resultado-title">
                <h2 id="resultado-title" tabindex="-1">Resultado da Triagem</h2>
                <p class="resultado-description">
                    An√°lise realizada com sucesso utilizando intelig√™ncia artificial.
                </p>
            </section>

            <div class="resultado-card">
                <div class="classificacao-principal">
                    <div class="risco-badge risco-{{ result.risk_color.lower() }}">
                        <span class="risco-emoji">
                            {% if result.risk_color == 'VERMELHO' %}üî¥
                            {% elif result.risk_color == 'AMARELO' %}üü°
                            {% else %}üü¢
                            {% endif %}
                        </span>
                        <div class="risco-info">
                            <h3>{{ result.classification }}</h3>
                            <p class="risco-nivel">N√≠vel: {{ result.risk_color }}</p>
                            <p class="confianca" role="status" aria-live="polite">
                                Confian√ßa: {{ (result.confidence * 100) | round(1) }}%
                            </p>
                        </div>
                    </div>
                </div>

                <div class="resultado-detalhes">
                    <section aria-labelledby="raciocinio-title">
                        <h4 id="raciocinio-title">Racioc√≠nio da IA</h4>
                        <p class="raciocinio-texto">{{ result.reasoning }}</p>
                    </section>

                    <section aria-labelledby="recomendacoes-title">
                        <h4 id="recomendacoes-title">Recomenda√ß√µes</h4>
                        <ul class="recomendacoes-lista">
                            {% for recomendacao in result.recommendations %}
                                <li>{{ recomendacao }}</li>
                            {% endfor %}
                        </ul>
                    </section>

                    <section aria-labelledby="protocolo-title">
                        <h4 id="protocolo-title">Protocolo de Atendimento</h4>
                        <div class="protocolo-info">
                            {% if result.risk_color == 'VERMELHO' %}
                                <div class="protocolo-emergencia">
                                    <h5>‚ö†Ô∏è EMERG√äNCIA</h5>
                                    <p><strong>Tempo de atendimento:</strong> IMEDIATO</p>
                                    <p><strong>Prioridade:</strong> M√°xima</p>
                                    <p><strong>A√ß√µes:</strong> Acionar equipe m√©dica, preparar sala de emerg√™ncia</p>
                                </div>
                            {% elif result.risk_color == 'AMARELO' %}
                                <div class="protocolo-urgente">
                                    <h5>‚ö° URGENTE</h5>
                                    <p><strong>Tempo de atendimento:</strong> At√© 1 hora</p>
                                    <p><strong>Prioridade:</strong> Alta</p>
                                    <p><strong>A√ß√µes:</strong> Monitoriza√ß√£o, reavalia√ß√£o em 30 minutos</p>
                                </div>
                            {% else %}
                                <div class="protocolo-nao-urgente">
                                    <h5>‚úÖ N√ÉO URGENTE</h5>
                                    <p><strong>Tempo de atendimento:</strong> At√© 4 horas</p>
                                    <p><strong>Prioridade:</strong> Normal</p>
                                    <p><strong>A√ß√µes:</strong> Aguardar na fila, orienta√ß√µes gerais</p>
                                </div>
                            {% endif %}
                        </div>
                    </section>
                </div>

                <div class="resultado-meta">
                    <p class="timestamp">
                        <strong>Data/Hora:</strong> {{ result.timestamp }}
                    </p>
                    <p class="disclaimer">
                        <strong>Importante:</strong> Este resultado √© uma sugest√£o baseada em IA e deve ser 
                        validado por um profissional de sa√∫de qualificado.
                    </p>
                </div>
            </div>

            <div class="resultado-acoes">
                <a href="{{ url_for('triagem') }}" class="btn btn-primary">
                    Nova Triagem
                </a>
                <button onclick="window.print()" class="btn btn-secondary">
                    Imprimir Resultado
                </button>
                <button onclick="salvarResultado()" class="btn btn-outline">
                    Salvar Resultado
                </button>
            </div>
        </div>
    </main>

    <footer role="contentinfo">
        <div class="container">
            <p>&copy; 2025 Sistema de Triagem Hospitalar Inteligente</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        function salvarResultado() {
            const resultado = {
                classificacao: {{ result.classification | tojson }},
                risco: {{ result.risk_color | tojson }},
                confianca: {{ result.confidence | tojson }},
                raciocinio: {{ result.reasoning | tojson }},
                recomendacoes: {{ result.recommendations | tojson }},
                timestamp: {{ result.timestamp | tojson }}
            };
            
            const blob = new Blob([JSON.stringify(resultado, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'resultado_triagem_' + new Date().toISOString().slice(0, 10) + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Anunciar resultado para leitores de tela
        document.addEventListener('DOMContentLoaded', function() {
            const resultado = {{ result.classification | tojson }};
            const confianca = {{ (result.confidence * 100) | round(1) }};
            
            // Criar an√∫ncio acess√≠vel
            const anuncio = document.createElement('div');
            anuncio.setAttribute('aria-live', 'assertive');
            anuncio.setAttribute('aria-atomic', 'true');
            anuncio.className = 'sr-only';
            anuncio.textContent = `Resultado da triagem: ${resultado} com ${confianca}% de confian√ßa`;
            
            document.body.appendChild(anuncio);
            
            // Focar no resultado
            document.getElementById('resultado-title').focus();
        });
    </script>
</body>
</html>
